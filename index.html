<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gyro 1800° Tracker</title>
<style>
  body { font-family: sans-serif; text-align: center; padding: 50px; }
  #value { font-size: 2em; margin-top: 20px; }
  #circle {
    width: 200px; height: 200px; border: 5px solid #333; border-radius: 50%;
    margin: 40px auto; transform: rotate(0deg); transition: transform 0.05s linear;
  }
</style>
</head>
<body>
<h1>Gyroscope Tracker</h1>
<div id="circle"></div>
<div id="value">0°</div>

<script>
let lastAlpha = null;
let totalRotation = 0;

window.addEventListener('deviceorientation', (event) => {
    let alpha = event.alpha; // หมุนรอบแกน Z
    if (lastAlpha !== null) {
        // คำนวณความต่างแบบ wrap-around
        let delta = alpha - lastAlpha;
        if (delta > 180) delta -= 360;
        if (delta < -180) delta += 360;
        totalRotation += delta;
        // จำกัดให้แสดงแค่ ±1800°
        if(totalRotation > 1800) totalRotation = 1800;
        if(totalRotation < -1800) totalRotation = -1800;
    }
    lastAlpha = alpha;

    document.getElementById('value').textContent = totalRotation.toFixed(1) + '°';
    document.getElementById('circle').style.transform = `rotate(${totalRotation}deg)`;
});

// สำหรับมือถือ iOS 13+ ต้องขอสิทธิ์ก่อน
if (typeof DeviceOrientationEvent !== 'undefined' &&
    typeof DeviceOrientationEvent.requestPermission === 'function') {
    DeviceOrientationEvent.requestPermission()
        .then(permissionState => {
            if (permissionState === 'granted') {
                console.log('Permission granted');
            } else {
                alert('ต้องอนุญาตให้ใช้ Gyroscope');
            }
        })
        .catch(console.error);
}
</script>
</body>
</html>
