<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Gyro ‚Äì ‡∏≠‡πà‡∏≤‡∏ô‡∏ó‡∏∏‡∏Å‡∏î‡πâ‡∏≤‡∏ô</title>
<style>
  body { font-family: sans-serif; padding: 16px; background: #fff7ed; }
  h1 { color: #ff7a18; font-size: 1.2rem; }
  .card { background: #fff1e6; border-radius: 12px; padding: 12px; margin-top: 12px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
  .big { font-size: 1.5rem; font-weight: bold; }
  .muted { color: #555; font-size: 0.9rem; }
</style>
</head>
<body>
  <h1>Gyro Orientation</h1>
  <div class="card">
    <div>Alpha (Z): <span class="big" id="rawAlpha">‚Äî</span>¬∞</div>
    <div>Beta (X): <span class="big" id="rawBeta">‚Äî</span>¬∞</div>
    <div>Gamma (Y): <span class="big" id="rawGamma">‚Äî</span>¬∞</div>
    <div class="muted">Accumulated ‚Üí <span id="accum">‚Äî</span></div>
  </div>

<script>
(() => {
  let prev = {alpha:null,beta:null,gamma:null};
  let accum = {alpha:0,beta:0,gamma:0};
  let smoothed = {alpha:null,beta:null,gamma:null};
  let smooth = 0.15;

  const rawAlpha=document.getElementById('rawAlpha');
  const rawBeta=document.getElementById('rawBeta');
  const rawGamma=document.getElementById('rawGamma');
  const accumEl=document.getElementById('accum');

  function clamp180(v){
    return ((v + 180) % 360 + 360) % 360 - 180;
  }
  function unwrapDelta(prev, cur){
    if(prev===null||cur===null) return 0;
    let d = cur - prev;
    if(d>180) d -= 360;
    if(d<-180) d += 360;
    return d;
  }
  function lowpass(prev,cur,a){
    if(prev===null) return cur;
    return prev*(1-a)+cur*a;
  }
  // üîß Fix ‡∏ï‡∏¥‡∏î 90¬∞
  function fixFlip(beta,gamma){
    if(gamma>90){ gamma=180-gamma; beta=beta>0?180-beta:-180-beta; }
    if(gamma<-90){ gamma=-180-gamma; beta=beta>0?180-beta:-180-beta; }
    return {beta,gamma};
  }

  function handleOri(e){
    let alpha = e.alpha!==null?clamp180(e.alpha):null;
    let beta  = e.beta!==null?clamp180(e.beta):null;
    let gamma = e.gamma!==null?clamp180(e.gamma):null;

    if(beta!==null&&gamma!==null){
      const fixed=fixFlip(beta,gamma);
      beta=fixed.beta; gamma=fixed.gamma;
    }

    let dA=unwrapDelta(prev.alpha,alpha);
    let dB=unwrapDelta(prev.beta ,beta );
    let dG=unwrapDelta(prev.gamma,gamma);

    accum.alpha+=dA; accum.beta+=dB; accum.gamma+=dG;

    smoothed.alpha=lowpass(smoothed.alpha,alpha,smooth);
    smoothed.beta =lowpass(smoothed.beta ,beta ,smooth);
    smoothed.gamma=lowpass(smoothed.gamma,gamma,smooth);

    prev.alpha=alpha; prev.beta=beta; prev.gamma=gamma;

    rawAlpha.textContent=alpha?.toFixed(1)??'‚Äî';
    rawBeta.textContent =beta?.toFixed(1)??'‚Äî';
    rawGamma.textContent=gamma?.toFixed(1)??'‚Äî';
    accumEl.textContent=`Œ±:${accum.alpha.toFixed(1)}¬∞ Œ≤:${accum.beta.toFixed(1)}¬∞ Œ≥:${accum.gamma.toFixed(1)}¬∞`;
  }

  window.addEventListener('deviceorientation',handleOri);
})();
</script>
</body>
</html>
