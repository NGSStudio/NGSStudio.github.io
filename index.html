<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gyro Roll Tracker</title>
<style>
  body { font-family: sans-serif; text-align: center; padding: 50px; background: #FFF7ED; color: #9C4221; }
  #roll { font-size: 3em; margin: 20px 0; }
  #circle { width: 150px; height: 150px; border-radius: 50%; border: 4px solid #9C4221; margin: 0 auto; transform-origin: center center; transition: transform 0.05s linear; }
</style>
</head>
<body>
<h1>Gyro Roll Tracker</h1>
<div id="roll">0°</div>
<div id="circle"></div>

<script>
let lastGamma = null;
let totalRoll = 0;

function handleOrientation(event) {
    let gamma = event.gamma; // -90 ถึง +90

    if(lastGamma !== null){
        let diff = gamma - lastGamma;

        // detect cross over boundary
        if(diff > 180) diff -= 360;
        if(diff < -180) diff += 360;

        // สำหรับ -90 ถึง 90 ต้อง detect sudden flip
        if(diff > 90) diff = diff - 180;
        if(diff < -90) diff = diff + 180;

        totalRoll += diff;
    }

    lastGamma = gamma;

    document.getElementById('roll').innerText = totalRoll.toFixed(1) + '°';
    document.getElementById('circle').style.transform = `rotate(${totalRoll}deg)`;
}

// iOS permission
if (typeof DeviceOrientationEvent.requestPermission === 'function') {
    DeviceOrientationEvent.requestPermission()
    .then(permissionState => {
        if (permissionState === 'granted') {
            window.addEventListener('deviceorientation', handleOrientation);
        } else {
            alert("ไม่ได้รับอนุญาตอ่าน Gyro");
        }
    }).catch(console.error);
} else {
    window.addEventListener('deviceorientation', handleOrientation);
}
</script>
</body>
</html>
